<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="stylesheet.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
</head>

<body ng-app="searchForm" ng-controller="searchCtrl">
    
 <!--  ANIMATION  -->  
    <div id="animation">
        <h2 id="flick">FlickrSearch</h2> 
         
        <!--   (Angular) Search bar -->
        <form id="searchBar" ng-submit="myFunc()">
        <input type="text" placeholder="What do you want to see?" ng-model="keyword" pattern=".{0,20}">
        <input type="submit" value="Search">
        </form>
    </div>       

<section id="mainSection">

    <div id="left">
        

        <!-- CLEAR HISTORY BUTTON -->
        <script>        
        function clearHistory()
            {    
                $("li").remove();
                searchLabel = "History cleared";
                searches = 0;
                document.getElementById("history").innerHTML = searchLabel;
                $('#gallery').html('');

            }
        </script>

        <input type="submit" id="clearButton" onclick="clearHistory();" value="Clear history" />
        
        <!-- <button type="button" id="clearButton" onclick="clearHistory();">Clear history</button> -->

        <p id="history"></p>
        <ul id="searchList"> <!-- Empty search history --></ul>

        <script>
            // Variable to keep count of amount of searches \\
            var searches = 0;
            var maxSearches = 20;
            var searchLabel = "";


            var app = angular.module("searchForm", []);
            app.controller("searchCtrl", function($scope) {
                $scope.myFunc = function() {
                    $listHistory = $("#searchList");

                    if ($scope.keyword == "" || $scope.keyword == " ") return;

                    $("li").removeClass("current");
                    newItem = "<li id='" + $scope.keyword + "' class='current'>" + $scope.keyword + "</li>"; // Create new list item using the keyword
                    $listHistory.prepend(newItem);
                    
                    if ($("li").length > maxSearches) $("li:last").remove(); // If we have more than maxSearches, remove bottom search from history and don't increment.
                    else searches++; // If we have less than maxSearches increment searches

                    // Appropriate label for search history
                    if (searches == 1) searchLabel = "Last search: ";
                    else searchLabel = "Last " + searches + " searches:";
                    document.getElementById("history").innerHTML = searchLabel;

                    // AJAX request --- Moved here from mainpage.js
                    $.ajax('https://api.flickr.com/services/feeds/photos_public.gne',
    
                    {
                        dataType: 'jsonp',
                        // Set Tag to be the entry from the Angular searchbar
                        data: { "tags": $scope.keyword, "format": "json" }
                    });
                    // AJAX reply still handled in mainpage.js ( jsonFlickrFeed(json) )

                    $scope.keyword = ""; // Clear searchbar
                }
            });   
        </script>
    </div>

    <div id="right">
        <p id="results"></p>
        <div id="gallery"></div>
   </div>

</section>
    
    <script src="jquery-1.11.0.js"></script>
    <script src="mainpage.js"></script>
    <script src="animation.js"></script>
</body>

</html>